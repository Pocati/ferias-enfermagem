<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Férias - Enfermagem</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #c62828;
            --secondary: #d32f2f;
            --accent: #ef5350;
            --light: #ffcdd2;
            --dark: #b71c1c;
            --danger: #e53935;
            --success: #2e7d32;
            --warning: #ff8f00;
            --gray: #f5f5f5;
            --text: #212121;
            --vacation: #388e3c;
            /* Verde mais escuro para férias atuais */
            --upcoming: #ff9800;
            /* Laranja para próximas férias */
            --vacation-bg: #c8e6c9;
            --upcoming-bg: #ffe0b2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #fafafa;
            color: var(--text);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: white !important;
        }

        .search-container {
            display: flex;
            align-items: center;
            position: relative;
        }

        .search-bar {
            display: flex;
            background: white;
            border-radius: 4px;
            overflow: hidden;
        }

        .search-bar input {
            border: none;
            padding: 10px 15px;
            width: 250px;
            outline: none;
        }

        .search-bar button {
            background: var(--accent);
            border: none;
            color: white;
            padding: 10px 15px;
            cursor: pointer;
        }

        .search-results-container {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 5px;
            width: 100%;
            display: none;
        }

        .search-results-container.visible {
            display: block;
        }

        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-result-item:hover {
            background-color: #f5f5f5;
        }

        .close-search {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 16px;
            padding: 0 5px;
        }

        .close-search:hover {
            color: #333;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--secondary);
        }

        /* Navbar de enfermarias */
        .wards-navbar {
            display: flex;
            overflow-x: auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 10px;
        }

        .ward-tab {
            padding: 10px 15px;
            background-color: var(--light);
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            white-space: nowrap;
        }

        .ward-tab.active {
            background-color: var(--primary);
            color: white;
        }

        /* Filtro de turnos */
        .shift-filter {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
        }

        .shift-tab {
            padding: 10px 15px;
            background-color: var(--light);
            border-radius: 6px;
            cursor: pointer;
        }

        .shift-tab.active {
            background-color: var(--primary);
            color: white;
        }

        /* Layout principal */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .vacation-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .vacation-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        .toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .toggle-content {
            margin-top: 10px;
        }

        .toggle-content.hidden {
            display: none;
        }

        .vacation-list {
            margin-top: 10px;
        }

        .vacation-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f5f5f5;
            /* Fundo cinza */
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .remove-vacation-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Quadro de funcionários */
        .employees-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .shift-view {
            grid-column: 1 / -1;
        }

        .employee-list {
            min-height: 100px;
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 6px;
            background-color: #f9f9f9;
        }

        .employee-item {
            background-color: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-item.on-vacation {
            background-color: var(--vacation-bg);
            border-left: 4px solid var(--vacation);
        }

        .employee-item.upcoming-vacation {
            background-color: var(--upcoming-bg);
            border-left: 4px solid var(--upcoming);
        }

        .employee-name {
            font-weight: 500;
        }

        .employee-role {
            font-size: 12px;
            color: #777;
        }

        .employee-actions {
            display: flex;
            gap: 5px;
        }

        button.delete-btn {
            background-color: transparent;
            color: var(--danger);
            padding: 5px;
        }

        button.edit-btn {
            background-color: transparent;
            color: var(--secondary);
            padding: 5px;
        }

        button.move-btn {
            background-color: transparent;
            color: var(--primary);
            padding: 5px;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            background-color: #fff4e6;
            border-left: 4px solid var(--warning);
            position: relative;
        }

        .alert.hidden {
            display: none;
        }

        .alert-toggle {
            position: absolute;
            right: 15px;
            top: 15px;
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #757575;
        }

        .requirements {
            font-size: 14px;
            color: #757575;
            margin-top: 5px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
        }

        footer {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            text-align: center;
            padding: 15px;
            margin-top: 30px;
        }

        @media (max-width: 1024px) {
            .employees-board {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .employees-board {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .search-bar input {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Gestão de Férias - Enfermagem</h1>
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Buscar funcionário..." autocomplete="off">
                    <button id="searchButton"><i class="fas fa-search"></i></button>
                </div>
                <div id="searchResultsContainer" class="search-results-container">
                    <div class="search-result-item">
                        <span>Resultados da busca</span>
                        <button class="close-search" onclick="closeSearchResults()">&times;</button>
                    </div>
                </div>
            </div>
        </header>

        <section id="alertSection" class="alert hidden">
            <div class="toggle-header" onclick="toggleAlert()">
                <h3 id="alertMessage"></h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="alertDetails" class="toggle-content"></div>
        </section>

        <main class="main-layout">
            <div class="left-panel">
                <div class="card">
                    <h2>Cadastrar Funcionário</h2>
                    <form id="employeeForm">
                        <div class="form-group">
                            <label for="name">Nome:</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="role">Função:</label>
                            <select id="role" required>
                                <option value="Técnico em Enfermagem">Técnico em Enfermagem</option>
                                <option value="Enfermeiro">Enfermeiro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ward">Enfermaria:</label>
                            <select id="ward" required>
                                <option value="A.T">A.T</option>
                                <option value="Ambulatório">Ambulatório</option>
                                <option value="CCP">CCP</option>
                                <option value="CEMES">CEMES</option>
                                <option value="CSO">CSO</option>
                                <option value="Curativo">Curativo</option>
                                <option value="LI">LI</option>
                                <option value="LII">LII</option>
                                <option value="M.A">M.A</option>
                                <option value="SCIH">SCIH</option>
                                <option value="UCI">UCI</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shift">Turno:</label>
                            <select id="shift" required>
                                <option value="Manhã">Manhã</option>
                                <option value="Tarde">Tarde</option>
                                <option value="Noite">Noite</option>
                            </select>
                        </div>
                        <button type="submit" id="submitButton">Adicionar Funcionário</button>
                    </form>
                </div>
            </div>

            <div class="right-panel">
                <div class="vacation-section">
                    <div class="vacation-card">
                        <div class="toggle-header" onclick="toggleSection('currentVacations')">
                            <h3>Férias do Mês Atual</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="currentVacations" class="toggle-content hidden"></div>
                    </div>
                    <div class="vacation-card">
                        <div class="toggle-header" onclick="toggleSection('nextVacations')">
                            <h3>Próximas Férias</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div id="nextVacations" class="toggle-content hidden"></div>
                    </div>
                </div>
            </div>
        </main>

        <section class="board-section">
            <div id="wardsNavbar" class="wards-navbar"></div>
            <div id="shiftFilter" class="shift-filter"></div>
            <div id="employeesBoard" class="employees-board"></div>
        </section>
    </div>

    <!-- Modal de Férias -->
    <div id="vacationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrar Férias</h2>
                <span class="close">&times;</span>
            </div>
            <form id="vacationForm">
                <input type="hidden" id="vacationEmployeeId">
                <div class="form-group">
                    <label for="vacationStart">Início das Férias:</label>
                    <input type="date" id="vacationStart" required>
                </div>
                <div class="form-group">
                    <label for="vacationDays">Dias de Férias:</label>
                    <input type="number" id="vacationDays" min="1" max="30" value="30" required>
                </div>
                <div class="form-group">
                    <label for="vacationEnd">Término das Férias:</label>
                    <input type="date" id="vacationEnd" readonly>
                </div>
                <button type="submit">Salvar Férias</button>
            </form>
        </div>
    </div>

    <!-- Modal de Mover -->
    <div id="moveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mover Funcionário</h2>
                <span class="close">&times;</span>
            </div>
            <form id="moveForm">
                <input type="hidden" id="moveEmployeeId">
                <div class="form-group">
                    <label for="moveWard">Nova Enfermaria:</label>
                    <select id="moveWard" required>
                        <option value="A.T">A.T</option>
                        <option value="Ambulatório">Ambulatório</option>
                        <option value="CCP">CCP</option>
                        <option value="CEMES">CEMES</option>
                        <option value="CSO">CSO</option>
                        <option value="Curativo">Curativo</option>
                        <option value="LI">LI</option>
                        <option value="LII">LII</option>
                        <option value="M.A">M.A</option>
                        <option value="SCIH">SCIH</option>
                        <option value="UCI">UCI</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="moveShift">Novo Turno:</label>
                    <select id="moveShift" required>
                        <option value="Manhã">Manhã</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Noite">Noite</option>
                    </select>
                </div>
                <button type="submit">Mover Funcionário</button>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmação</h2>
                <span class="close">&times;</span>
            </div>
            <p id="confirmationMessage"></p>
            <div class="confirmation-buttons">
                <button id="confirmYes">Sim</button>
                <button id="confirmNo">Não</button>
            </div>
        </div>
    </div>

    <!-- Modal de Autenticação -->
    <div id="authModal" class="modal" style="display: flex;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acesso Restrito</h2>
            </div>
            <form id="authForm">
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">Acessar Sistema</button>
            </form>
        </div>
    </div>

    <footer>
        Criado e desenvolvido por Hipócrates Matheus
    </footer>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // ================== CONFIGURAÇÃO DO FIREBASE ==================
        const firebaseConfig = {
            apiKey: "AIzaSyDd1lBoSFXMCYnV6PiP_v51StGUZgD-eMw",
            authDomain: "ferias-enfermagem.firebaseapp.com",
            projectId: "ferias-enfermagem",
            storageBucket: "ferias-enfermagem.firebasestorage.app",
            messagingSenderId: "265712802426",
            appId: "1:265712802426:web:4b1f39a4568d7a911e39c3"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ================== VARIÁVEIS GLOBAIS ==================
        let employees = [];
        let vacations = [];
        let selectedWard = null;
        let selectedShift = null;
        let pendingAction = null;
        let isAuthenticated = false;

        // ================== AUTENTICAÇÃO ==================
        const CORRECT_PASSWORD = "admin123";

        function checkAuthentication() {
            const savedAuth = localStorage.getItem('feriasAuth');
            if (savedAuth === CORRECT_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('authModal').style.display = 'none';
            } else {
                document.getElementById('authModal').style.display = 'flex';
            }
        }

        document.getElementById('authForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const password = document.getElementById('password').value;

            if (password === CORRECT_PASSWORD) {
                isAuthenticated = true;
                localStorage.setItem('feriasAuth', password);
                document.getElementById('authModal').style.display = 'none';
                initializeApp();
            } else {
                alert('Senha incorreta!');
            }
        });

        // ================== FUNÇÕES DO FIREBASE ==================
        async function saveEmployee(employee) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return null;
            }

            try {
                const nomeExistente = employees.find(emp =>
                    emp.name.toLowerCase() === employee.name.toLowerCase() && emp.id !== employee.id
                );

                if (nomeExistente) {
                    throw new Error("Já existe um funcionário com este nome!");
                }

                if (employee.id && employee.id.startsWith('firebase_')) {
                    const firebaseId = employee.id.replace('firebase_', '');
                    await db.collection('employees').doc(firebaseId).set(employee);
                    return employee.id;
                } else {
                    const docRef = await db.collection('employees').add(employee);
                    return 'firebase_' + docRef.id;
                }
            } catch (error) {
                console.error("Erro ao salvar no Firebase:", error);
                throw error;
            }
        }

        async function loadEmployees() {
            try {
                const snapshot = await db.collection('employees').get();
                employees = [];
                snapshot.forEach(doc => {
                    employees.push({ id: 'firebase_' + doc.id, ...doc.data() });
                });

                employees.sort((a, b) => a.name.localeCompare(b.name));

                return employees;
            } catch (error) {
                console.error("Erro ao carregar funcionários:", error);
                return [];
            }
        }

        async function saveVacation(vacation) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return null;
            }

            try {
                if (vacation.id && vacation.id.startsWith('firebase_')) {
                    const firebaseId = vacation.id.replace('firebase_', '');
                    await db.collection('vacations').doc(firebaseId).set(vacation);
                    return vacation.id;
                } else {
                    const docRef = await db.collection('vacations').add(vacation);
                    return 'firebase_' + docRef.id;
                }
            } catch (error) {
                console.error("Erro ao salvar férias:", error);
                throw error;
            }
        }

        async function loadVacations() {
            try {
                const snapshot = await db.collection('vacations').get();
                vacations = [];
                snapshot.forEach(doc => {
                    vacations.push({ id: 'firebase_' + doc.id, ...doc.data() });
                });
                return vacations;
            } catch (error) {
                console.error("Erro ao carregar férias:", error);
                return [];
            }
        }

        async function deleteEmployee(employeeId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            try {
                if (employeeId.startsWith('firebase_')) {
                    const firebaseId = employeeId.replace('firebase_', '');
                    await db.collection('employees').doc(firebaseId).delete();

                    const vacationQuery = await db.collection('vacations')
                        .where('employeeId', '==', employeeId)
                        .get();

                    const deletePromises = [];
                    vacationQuery.forEach(doc => {
                        deletePromises.push(doc.ref.delete());
                    });

                    await Promise.all(deletePromises);
                }
            } catch (error) {
                console.error("Erro ao excluir funcionário:", error);
                throw error;
            }
        }

        async function deleteVacation(vacationId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            try {
                if (vacationId.startsWith('firebase_')) {
                    const firebaseId = vacationId.replace('firebase_', '');
                    await db.collection('vacations').doc(firebaseId).delete();
                }
            } catch (error) {
                console.error("Erro ao excluir férias:", error);
                throw error;
            }
        }

        // ================== FUNÇÕES DE UI/UX ==================
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = section.previousElementSibling.querySelector('i');

            section.classList.toggle('hidden');
            icon.classList.toggle('fa-chevron-down');
            icon.classList.toggle('fa-chevron-up');
        }

        function toggleAlert() {
            const alertDetails = document.getElementById('alertDetails');
            const icon = document.querySelector('#alertSection .fa-chevron-down, #alertSection .fa-chevron-up');

            alertDetails.classList.toggle('hidden');
            if (icon) {
                icon.classList.toggle('fa-chevron-down');
                icon.classList.toggle('fa-chevron-up');
            }
        }

        function showModal(modalId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showConfirmation(message, callback) {
            document.getElementById('confirmationMessage').textContent = message;
            pendingAction = callback;
            showModal('confirmationModal');
        }

        function closeSearchResults() {
            document.getElementById('searchResultsContainer').classList.remove('visible');
        }

        // ================== FUNÇÕES PRINCIPAIS ==================
        function initializeApp() {
            if (!isAuthenticated) return;

            setupEventListeners();
            loadAllData();
            renderWardsNavbar();
            renderShiftFilter();
        }

        async function loadAllData() {
            employees = await loadEmployees();
            vacations = await loadVacations();
            renderEmployeesBoard();
            renderVacationLists();
            checkRequirements();
            checkVacationConflicts();
        }

        function setupEventListeners() {
            document.getElementById('employeeForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                await addEmployee();
            });

            document.getElementById('searchButton').addEventListener('click', searchEmployee);
            document.getElementById('searchInput').addEventListener('input', function (e) {
                if (e.target.value === '') {
                    closeSearchResults();
                }
            });
            document.getElementById('searchInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    searchEmployee();
                    e.preventDefault();
                }
            });

            document.addEventListener('click', function (e) {
                const resultsContainer = document.getElementById('searchResultsContainer');
                const searchContainer = document.querySelector('.search-container');

                if (!searchContainer.contains(e.target) && resultsContainer.classList.contains('visible')) {
                    resultsContainer.classList.remove('visible');
                }
            });

            document.getElementById('vacationStart').addEventListener('change', calculateVacationEnd);
            document.getElementById('vacationDays').addEventListener('input', calculateVacationEnd);

            document.getElementById('vacationForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                await saveVacationData();
            });

            document.getElementById('moveForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                await moveEmployeeData();
            });

            document.getElementById('confirmYes').addEventListener('click', function () {
                if (pendingAction) {
                    pendingAction();
                    pendingAction = null;
                }
                hideModal('confirmationModal');
            });

            document.getElementById('confirmNo').addEventListener('click', function () {
                pendingAction = null;
                hideModal('confirmationModal');
            });

            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function () {
                    this.closest('.modal').style.display = 'none';
                });
            });

            window.addEventListener('click', function (event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
        }

        async function addEmployee() {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            const name = document.getElementById('name').value;
            const role = document.getElementById('role').value;
            const ward = document.getElementById('ward').value;
            const shift = document.getElementById('shift').value;

            const submitButton = document.getElementById('submitButton');
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cadastrando...';
            submitButton.disabled = true;

            try {
                const newEmployee = { name, role, ward, shift };
                const employeeId = await saveEmployee(newEmployee);

                employees.push({ id: employeeId, ...newEmployee });
                employees.sort((a, b) => a.name.localeCompare(b.name));

                document.getElementById('name').value = '';

                updateEmployeeInBoard(employeeId);
                renderShiftFilter();
                checkRequirements();
                checkVacationConflicts();

            } catch (error) {
                alert(error.message);
            } finally {
                submitButton.innerHTML = 'Adicionar Funcionário';
                submitButton.disabled = false;
            }
        }

        function searchEmployee() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const resultsContainer = document.getElementById('searchResultsContainer');

            if (!searchTerm) {
                resultsContainer.classList.remove('visible');
                return;
            }

            const results = employees.filter(emp =>
                emp.name.toLowerCase().includes(searchTerm)
            );

            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="search-result-item">Nenhum funcionário encontrado</div>';
            } else {
                resultsContainer.innerHTML = results.map(emp => `
            <div class="search-result-item" data-id="${emp.id}">
                <div>
                    <div><strong>${emp.name}</strong></div>
                    <small>${emp.role} - ${emp.ward} (${emp.shift})</small>
                </div>
            </div>
        `).join('');

                resultsContainer.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', function () {
                        const employeeId = this.getAttribute('data-id');
                        const employee = employees.find(emp => emp.id === employeeId);
                        if (employee) {
                            selectWard(employee.ward);
                            selectShift(employee.shift);

                            resultsContainer.classList.remove('visible');
                            document.getElementById('searchInput').value = '';

                            document.querySelector('.board-section').scrollIntoView({
                                behavior: 'smooth'
                            });
                        }
                    });
                });
            }

            resultsContainer.classList.add('visible');
        }

        // ================== FUNÇÕES DOS BOTÕES ==================
        function openVacationModal(employeeId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;

            document.getElementById('vacationEmployeeId').value = employeeId;
            document.getElementById('vacationStart').value = '';
            document.getElementById('vacationDays').value = '30';
            document.getElementById('vacationEnd').value = '';

            // Verificar se já tem férias cadastradas
            const existingVacation = vacations.find(v => v.employeeId === employeeId);
            if (existingVacation) {
                document.getElementById('vacationStart').value = existingVacation.start;
                document.getElementById('vacationDays').value = existingVacation.days;

                // Mostrar opção de resetar férias
                const form = document.getElementById('vacationForm');
                const existingButton = form.querySelector('.reset-vacation-btn');
                if (!existingButton) {
                    const resetButton = document.createElement('button');
                    resetButton.type = 'button';
                    resetButton.className = 'reset-vacation-btn';
                    resetButton.style.backgroundColor = 'var(--warning)';
                    resetButton.style.marginLeft = '10px';
                    resetButton.textContent = 'Resetar Férias';
                    resetButton.onclick = function () {
                        showConfirmation(
                            `Tem certeza que deseja resetar as férias de ${employee.name}?`,
                            async () => {
                                try {
                                    await deleteVacation(existingVacation.id);
                                    // CORREÇÃO: Atualizar a lista de férias e recarregar tudo
                                    vacations = vacations.filter(v => v.id !== existingVacation.id);
                                    document.getElementById('vacationStart').value = '';
                                    document.getElementById('vacationDays').value = '30';
                                    document.getElementById('vacationEnd').value = '';
                                    resetButton.remove();

                                    // CORREÇÃO: Recarregar tudo para garantir que os status sejam atualizados
                                    renderEmployeesBoard();
                                    renderVacationLists();
                                    checkVacationConflicts();
                                } catch (error) {
                                    alert("Erro ao resetar férias: " + error.message);
                                }
                            }
                        );
                    };
                    form.querySelector('button[type="submit"]').insertAdjacentElement('afterend', resetButton);
                }
            } else {
                // Remover botão de reset se existir
                const resetButton = document.querySelector('.reset-vacation-btn');
                if (resetButton) resetButton.remove();

                // Preencher data de início sugerida (sem problemas de fuso horário)
                const suggestedStart = new Date();
                suggestedStart.setDate(suggestedStart.getDate() + 15);
                const formattedDate = suggestedStart.toISOString().split('T')[0];
                document.getElementById('vacationStart').value = formattedDate;
            }

            calculateVacationEnd();
            showModal('vacationModal');
        }

        function openMoveModal(employeeId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;

            document.getElementById('moveEmployeeId').value = employeeId;
            document.getElementById('moveWard').value = employee.ward;
            document.getElementById('moveShift').value = employee.shift;

            showModal('moveModal');
        }

        function confirmDeleteEmployee(employeeId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) return;

            showConfirmation(
                `Tem certeza que deseja excluir ${employee.name}?`,
                async () => {
                    try {
                        await deleteEmployee(employeeId);
                        employees = employees.filter(emp => emp.id !== employeeId);
                        vacations = vacations.filter(v => v.employeeId !== employeeId);

                        const employeeElement = document.querySelector(`.employee-item[data-id="${employeeId}"]`);
                        if (employeeElement) {
                            employeeElement.remove();
                        }

                        renderVacationLists();
                        renderShiftFilter();
                        checkRequirements();
                        checkVacationConflicts();
                    } catch (error) {
                        alert("Erro ao excluir funcionário: " + error.message);
                    }
                }
            );
        }

        function confirmRemoveVacation(vacationId) {
            if (!isAuthenticated) {
                alert('Acesso não autorizado');
                return;
            }

            const vacation = vacations.find(v => v.id === vacationId);
            if (!vacation) return;

            const employee = employees.find(emp => emp.id === vacation.employeeId);
            if (!employee) return;

            showConfirmation(
                `Tem certeza que deseja remover as férias de ${employee.name}?`,
                async () => {
                    try {
                        await deleteVacation(vacationId);
                        // CORREÇÃO: Atualizar a lista de férias
                        vacations = vacations.filter(v => v.id !== vacationId);

                        // CORREÇÃO: Recarregar tudo para garantir que os status sejam atualizados
                        renderEmployeesBoard();
                        renderVacationLists();
                        checkVacationConflicts();
                    } catch (error) {
                        alert("Erro ao remover férias: " + error.message);
                    }
                }
            );
        }

        async function saveVacationData() {
            const employeeId = document.getElementById('vacationEmployeeId').value;
            const startDateInput = document.getElementById('vacationStart').value;
            const days = parseInt(document.getElementById('vacationDays').value);

            if (!startDateInput || isNaN(days)) {
                alert('Por favor, preencha a data de início e o número de dias');
                return;
            }

            // CORREÇÃO: Garantir que a data de início está correta (sem problemas de fuso horário)
            const startDate = new Date(startDateInput + 'T12:00:00'); // Meio-dia para evitar problemas de fuso
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + days);

            try {
                const vacation = {
                    employeeId,
                    start: formatDate(startDate), // Data de início corrigida
                    end: formatDate(endDate),
                    days
                };

                // Verificar se já existe férias para este funcionário
                const existingVacationIndex = vacations.findIndex(v => v.employeeId === employeeId);
                if (existingVacationIndex !== -1) {
                    // Atualizar férias existentes
                    vacation.id = vacations[existingVacationIndex].id;
                    await saveVacation(vacation);
                    vacations[existingVacationIndex] = vacation;
                } else {
                    // Criar novas férias
                    const vacationId = await saveVacation(vacation);
                    vacations.push({ id: vacationId, ...vacation });
                }

                hideModal('vacationModal');

                // CORREÇÃO: Recarregar tudo para garantir que os status sejam atualizados
                renderEmployeesBoard();
                renderVacationLists();
                checkVacationConflicts();

                // Mostrar confirmação
                const employee = employees.find(emp => emp.id === employeeId);
                alert(`Férias de ${employee.name} definidas para ${formatDisplayDate(startDate)} até ${formatDisplayDate(endDate)}`);

            } catch (error) {
                alert("Erro ao salvar férias: " + error.message);
            }
        }

        async function moveEmployeeData() {
            const employeeId = document.getElementById('moveEmployeeId').value;
            const newWard = document.getElementById('moveWard').value;
            const newShift = document.getElementById('moveShift').value;

            try {
                const employee = employees.find(emp => emp.id === employeeId);
                if (!employee) return;

                employee.ward = newWard;
                employee.shift = newShift;

                await saveEmployee(employee);

                hideModal('moveModal');

                updateEmployeeInBoard(employeeId);
                renderShiftFilter();
                checkRequirements();
                checkVacationConflicts();
            } catch (error) {
                alert("Erro ao mover funcionário: " + error.message);
            }
        }

        // ================== OUTRAS FUNÇÕES ==================
        function calculateVacationEnd() {
            const startDateInput = document.getElementById('vacationStart').value;
            const days = parseInt(document.getElementById('vacationDays').value);

            if (!startDateInput || isNaN(days)) {
                document.getElementById('vacationEnd').value = '';
                return;
            }

            // CORREÇÃO: Usar meio-dia para evitar problemas de fuso horário
            const startDate = new Date(startDateInput + 'T12:00:00');
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + days);

            document.getElementById('vacationEnd').value = formatDate(endDate);
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDisplayDate(date) {
            return date.toLocaleDateString('pt-BR');
        }

        function getVacationStatus(employeeId) {
            const now = new Date();
            now.setHours(12, 0, 0, 0); // Meio-dia para evitar problemas de fuso

            const employeeVacation = vacations.find(v => v.employeeId === employeeId);

            if (!employeeVacation) return null;

            const startDate = new Date(employeeVacation.start + 'T12:00:00');
            const endDate = new Date(employeeVacation.end + 'T12:00:00');

            // Verifica se está em férias atualmente
            if (now >= startDate && now <= endDate) {
                return 'current';
            }

            // Verifica se são férias futuras
            if (now < startDate) {
                // Verificar se é próximo mês
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                nextMonth.setDate(1);
                nextMonth.setHours(12, 0, 0, 0);

                const nextMonthEnd = new Date(nextMonth.getFullYear(), nextMonth.getMonth() + 1, 0);
                nextMonthEnd.setHours(12, 0, 0, 0);

                if (startDate >= nextMonth && startDate <= nextMonthEnd) {
                    return 'upcoming';
                }

                return 'future';
            }

            return null;
        }

        function renderVacationLists() {
            const now = new Date();
            now.setHours(12, 0, 0, 0);

            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            // Férias do mês atual
            const currentVacations = vacations.filter(v => {
                const startDate = new Date(v.start + 'T12:00:00');
                const endDate = new Date(v.end + 'T12:00:00');
                return (now >= startDate && now <= endDate) ||
                    (startDate.getMonth() === currentMonth && startDate.getFullYear() === currentYear);
            });

            // Próximas férias (próximo mês)
            const nextMonth = currentMonth === 11 ? 0 : currentMonth + 1;
            const nextYear = currentMonth === 11 ? currentYear + 1 : currentYear;

            const nextVacations = vacations.filter(v => {
                const startDate = new Date(v.start + 'T12:00:00');
                return startDate.getMonth() === nextMonth && startDate.getFullYear() === nextYear;
            });

            // Renderizar férias atuais
            const currentList = document.getElementById('currentVacations');
            if (currentVacations.length === 0) {
                currentList.innerHTML = '<div class="empty-state">Nenhuma férias este mês</div>';
            } else {
                currentList.innerHTML = currentVacations.map(v => {
                    const employee = employees.find(emp => emp.id === v.employeeId);
                    if (!employee) return '';

                    const startDate = new Date(v.start + 'T12:00:00');
                    const endDate = new Date(v.end + 'T12:00:00');

                    return `
                <div class="vacation-item">
                    <div>
                        <div><strong>${employee.name}</strong> (${employee.role})</div>
                        <div>${employee.ward} - ${employee.shift}</div>
                        <div>${formatDisplayDate(startDate)} - ${formatDisplayDate(endDate)}</div>
                        <small>${v.days} dias de férias</small>
                    </div>
                    <button class="remove-vacation-btn" onclick="confirmRemoveVacation('${v.id}')">
                        Remover
                    </button>
                </div>
            `;
                }).join('');
            }

            // Renderizar próximas férias
            const nextList = document.getElementById('nextVacations');
            if (nextVacations.length === 0) {
                nextList.innerHTML = '<div class="empty-state">Nenhuma férias no próximo mês</div>';
            } else {
                nextList.innerHTML = nextVacations.map(v => {
                    const employee = employees.find(emp => emp.id === v.employeeId);
                    if (!employee) return '';

                    const startDate = new Date(v.start + 'T12:00:00');
                    const endDate = new Date(v.end + 'T12:00:00');

                    return `
                <div class="vacation-item">
                    <div>
                        <div><strong>${employee.name}</strong> (${employee.role})</div>
                        <div>${employee.ward} - ${employee.shift}</div>
                        <div>${formatDisplayDate(startDate)} - ${formatDisplayDate(endDate)}</div>
                        <small>${v.days} dias de férias</small>
                    </div>
                    <button class="remove-vacation-btn" onclick="confirmRemoveVacation('${v.id}')">
                        Remover
                    </button>
                </div>
            `;
                }).join('');
            }
        }

        // ================== FUNÇÕES DE RENDERIZAÇÃO ==================
        function renderWardsNavbar() {
            const wards = ['A.T', 'Ambulatório', 'CCP', 'CEMES', 'CSO', 'Curativo', 'LI', 'LII', 'M.A', 'SCIH', 'UCI'];
            const navbar = document.getElementById('wardsNavbar');

            navbar.innerHTML = wards.map(ward => `
        <div class="ward-tab" data-ward="${ward}">${ward}</div>
    `).join('');

            navbar.querySelectorAll('.ward-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    selectWard(this.getAttribute('data-ward'));
                });
            });
        }

        function renderShiftFilter() {
            const shifts = ['Manhã', 'Tarde', 'Noite'];
            const filter = document.getElementById('shiftFilter');

            const shiftCounts = {
                'Manhã': employees.filter(emp => emp.shift === 'Manhã' && getVacationStatus(emp.id) !== 'current').length,
                'Tarde': employees.filter(emp => emp.shift === 'Tarde' && getVacationStatus(emp.id) !== 'current').length,
                'Noite': employees.filter(emp => emp.shift === 'Noite' && getVacationStatus(emp.id) !== 'current').length
            };

            filter.innerHTML = shifts.map(shift => `
        <div class="shift-tab" data-shift="${shift}">${shift} (${shiftCounts[shift]})</div>
    `).join('');

            filter.querySelectorAll('.shift-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    selectShift(this.getAttribute('data-shift'));
                });
            });
        }

        function selectWard(ward) {
            selectedWard = ward;
            document.querySelectorAll('.ward-tab').forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-ward') === ward);
            });
            renderEmployeesBoard();
        }

        function selectShift(shift) {
            selectedShift = shift;
            document.querySelectorAll('.shift-tab').forEach(tab => {
                tab.classList.toggle('active', tab.getAttribute('data-shift') === shift);
            });
            renderEmployeesBoard();
        }

        function renderEmployeesBoard() {
            const board = document.getElementById('employeesBoard');
            board.innerHTML = '';

            // Filtrar funcionários - apenas os que estão ativos (não em férias atuais)
            const activeEmployees = employees.filter(emp => getVacationStatus(emp.id) !== 'current');

            if (selectedShift && !selectedWard) {
                board.classList.add('shift-view');

                const shiftEmployees = activeEmployees.filter(emp => emp.shift === selectedShift);
                const wards = [...new Set(shiftEmployees.map(emp => emp.ward))].sort();

                const columnCount = 3;
                const itemsPerColumn = Math.ceil(wards.length / columnCount);

                for (let i = 0; i < columnCount; i++) {
                    const columnWards = wards.slice(i * itemsPerColumn, (i + 1) * itemsPerColumn);

                    const columnElement = document.createElement('div');
                    columnElement.className = 'employee-column';

                    columnWards.forEach(ward => {
                        const wardEmployees = shiftEmployees.filter(emp => emp.ward === ward);

                        const groupElement = document.createElement('div');
                        groupElement.className = 'employee-group';

                        const title = document.createElement('h3');
                        title.textContent = `${ward} (${wardEmployees.length})`;

                        const listElement = document.createElement('div');
                        listElement.className = 'employee-list';

                        listElement.innerHTML = wardEmployees.map(employee => {
                            const vacationStatus = getVacationStatus(employee.id);
                            const vacationClass = vacationStatus === 'upcoming' ? 'upcoming-vacation' :
                                vacationStatus === 'future' ? 'future-vacation' : '';

                            let statusText = '';
                            if (vacationStatus === 'upcoming') {
                                statusText = '<div class="vacation-status">Férias no próximo mês</div>';
                            } else if (vacationStatus === 'future') {
                                statusText = '<div class="vacation-status">Férias programadas</div>';
                            }

                            return `
                        <div class="employee-item ${vacationClass}" data-id="${employee.id}">
                            <div>
                                <div class="employee-name">${employee.name}</div>
                                <div class="employee-role">${employee.role}</div>
                                ${statusText}
                            </div>
                            <div class="employee-actions">
                                <button class="move-btn" title="Mover" onclick="openMoveModal('${employee.id}')">
                                    <i class="fas fa-exchange"></i>
                                </button>
                                <button class="edit-btn" title="Editar férias" onclick="openVacationModal('${employee.id}')">
                                    <i class="fas fa-umbrella-beach"></i>
                                </button>
                                <button class="delete-btn" title="Excluir" onclick="confirmDeleteEmployee('${employee.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                        }).join('');

                        groupElement.appendChild(title);
                        groupElement.appendChild(listElement);
                        columnElement.appendChild(groupElement);
                    });

                    board.appendChild(columnElement);
                }
            } else {
                board.classList.remove('shift-view');

                const groupedEmployees = {};

                activeEmployees.forEach(employee => {
                    if (selectedWard && employee.ward !== selectedWard) return;
                    if (selectedShift && employee.shift !== selectedShift) return;

                    const key = `${employee.ward}-${employee.shift}`;
                    if (!groupedEmployees[key]) {
                        groupedEmployees[key] = [];
                    }
                    groupedEmployees[key].push(employee);
                });

                const sortedGroups = Object.entries(groupedEmployees).sort((a, b) => {
                    return a[0].localeCompare(b[0]);
                });

                sortedGroups.forEach(([key, groupEmployees]) => {
                    const [ward, shift] = key.split('-');
                    const groupElement = document.createElement('div');
                    groupElement.className = 'employee-group';

                    const title = document.createElement('h3');
                    title.textContent = `${ward} - ${shift} (${groupEmployees.length})`;

                    const listElement = document.createElement('div');
                    listElement.className = 'employee-list';

                    listElement.innerHTML = groupEmployees.map(employee => {
                        const vacationStatus = getVacationStatus(employee.id);
                        const vacationClass = vacationStatus === 'upcoming' ? 'upcoming-vacation' :
                            vacationStatus === 'future' ? 'future-vacation' : '';

                        let statusText = '';
                        if (vacationStatus === 'upcoming') {
                            statusText = '<div class="vacation-status">Férias no próximo mês</div>';
                        } else if (vacationStatus === 'future') {
                            statusText = '<div class="vacation-status">Férias programadas</div>';
                        }

                        return `
                    <div class="employee-item ${vacationClass}" data-id="${employee.id}">
                        <div>
                            <div class="employee-name">${employee.name}</div>
                            <div class="employee-role">${employee.role}</div>
                            ${statusText}
                        </div>
                        <div class="employee-actions">
                            <button class="move-btn" title="Mover" onclick="openMoveModal('${employee.id}')">
                                <i class="fas fa-exchange"></i>
                            </button>
                            <button class="edit-btn" title="Editar férias" onclick="openVacationModal('${employee.id}')">
                                <i class="fas fa-umbrella-beach"></i>
                            </button>
                            <button class="delete-btn" title="Excluir" onclick="confirmDeleteEmployee('${employee.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                    }).join('');

                    groupElement.appendChild(title);
                    groupElement.appendChild(listElement);
                    board.appendChild(groupElement);
                });
            }
        }

        function updateEmployeeInBoard(employeeId) {
            // CORREÇÃO: Simplificar - sempre renderizar o board completo para garantir consistência
            renderEmployeesBoard();
            renderShiftFilter();
        }

        function checkRequirements() {
            const nurseRequirements = {
                'LII': 2, 'CCP': 2, 'CSO': 2,
                'M.A': 1, 'LI': 1, 'UCI': 1, 'A.T': 1,
                'Ambulatório': 1, 'Curativo': 1, 'SCIH': 1,
                'CEMES': 1
            };

            const techRequirements = {
                'M.A': { 'Manhã': 6, 'Tarde': 6, 'Noite': 8 },
                'LII': { 'Manhã': 10, 'Tarde': 10, 'Noite': 12 },
                'LI': { 'Manhã': 5, 'Tarde': 5, 'Noite': 6 },
                'CCP': { 'Manhã': 10, 'Tarde': 10, 'Noite': 14 },
                'CSO': { 'Manhã': 7, 'Tarde': 7, 'Noite': 10 },
                'UCI': { 'Manhã': 5, 'Tarde': 5, 'Noite': 7 },
                'A.T': { 'Manhã': 1, 'Noite': 2 },
                'Ambulatório': { 'Manhã': 9, 'Tarde': 4 },
                'Curativo': { 'Manhã': 2 },
                'SCIH': { 'Manhã': 1 },
                'CEMES': { 'Manhã': 1, 'Tarde': 1, 'Noite': 1 }
            };

            let alertDetails = [];

            for (const [ward, minNurses] of Object.entries(nurseRequirements)) {
                const nurses = employees.filter(emp =>
                    emp.ward === ward &&
                    emp.role === 'Enfermeiro' &&
                    getVacationStatus(emp.id) !== 'current'
                );
                if (nurses.length < minNurses) {
                    alertDetails.push(`${ward}: ${nurses.length}/${minNurses} enfermeiros`);
                }
            }

            for (const [ward, shifts] of Object.entries(techRequirements)) {
                for (const [shift, minTechs] of Object.entries(shifts)) {
                    const techs = employees.filter(emp =>
                        emp.ward === ward &&
                        emp.shift === shift &&
                        emp.role === 'Técnico em Enfermagem' &&
                        getVacationStatus(emp.id) !== 'current'
                    );
                    if (techs.length < minTechs) {
                        alertDetails.push(`${ward} - ${shift}: ${techs.length}/${minTechs} técnicos`);
                    }
                }
            }

            const alertSection = document.getElementById('alertSection');
            const alertMessage = document.getElementById('alertMessage');
            const alertDetailsElement = document.getElementById('alertDetails');

            if (alertDetails.length > 0) {
                alertMessage.textContent = `Requisitos mínimos não atendidos (${alertDetails.length})`;
                alertDetailsElement.innerHTML = alertDetails.join('<br>');
                alertSection.classList.remove('hidden');
            } else {
                alertSection.classList.add('hidden');
            }
        }

        function checkVacationConflicts() {
            const nurseRequirements = {
                'LII': 2, 'CCP': 2, 'CSO': 2,
                'M.A': 1, 'LI': 1, 'UCI': 1, 'A.T': 1,
                'Ambulatório': 1, 'Curativo': 1, 'SCIH': 1,
                'CEMES': 1
            };

            const techRequirements = {
                'M.A': { 'Manhã': 6, 'Tarde': 6, 'Noite': 8 },
                'LII': { 'Manhã': 10, 'Tarde': 10, 'Noite': 12 },
                'LI': { 'Manhã': 5, 'Tarde': 5, 'Noite': 6 },
                'CCP': { 'Manhã': 10, 'Tarde': 10, 'Noite': 14 },
                'CSO': { 'Manhã': 7, 'Tarde': 7, 'Noite': 10 },
                'UCI': { 'Manhã': 5, 'Tarde': 5, 'Noite': 7 },
                'A.T': { 'Manhã': 1, 'Noite': 2 },
                'Ambulatório': { 'Manhã': 9, 'Tarde': 4 },
                'Curativo': { 'Manhã': 2 },
                'SCIH': { 'Manhã': 1 },
                'CEMES': { 'Manhã': 1, 'Tarde': 1, 'Noite': 1 }
            };

            let vacationConflicts = [];

            for (const [ward, minNurses] of Object.entries(nurseRequirements)) {
                const nursesOnVacation = employees.filter(emp =>
                    emp.ward === ward &&
                    emp.role === 'Enfermeiro' &&
                    getVacationStatus(emp.id) === 'current'
                ).length;

                const activeNurses = employees.filter(emp =>
                    emp.ward === ward &&
                    emp.role === 'Enfermeiro' &&
                    getVacationStatus(emp.id) !== 'current'
                ).length;

                if (activeNurses < minNurses && nursesOnVacation > 0) {
                    vacationConflicts.push(`${ward}: ${nursesOnVacation} enfermeiro(s) de férias com apenas ${activeNurses} ativo(s) (mínimo: ${minNurses})`);
                }
            }

            for (const [ward, shifts] of Object.entries(techRequirements)) {
                for (const [shift, minTechs] of Object.entries(shifts)) {
                    const techsOnVacation = employees.filter(emp =>
                        emp.ward === ward &&
                        emp.shift === shift &&
                        emp.role === 'Técnico em Enfermagem' &&
                        getVacationStatus(emp.id) === 'current'
                    ).length;

                    const activeTechs = employees.filter(emp =>
                        emp.ward === ward &&
                        emp.shift === shift &&
                        emp.role === 'Técnico em Enfermagem' &&
                        getVacationStatus(emp.id) !== 'current'
                    ).length;

                    if (activeTechs < minTechs && techsOnVacation > 0) {
                        vacationConflicts.push(`${ward} - ${shift}: ${techsOnVacation} técnico(s) de férias com apenas ${activeTechs} ativo(s) (mínimo: ${minTechs})`);
                    }
                }
            }

            if (vacationConflicts.length > 0) {
                alert(`CONFLITO DE FÉRIAS:\n\n${vacationConflicts.join('\n')}`);
            }
        }

        // ================== INICIALIZAÇÃO ==================
        document.addEventListener('DOMContentLoaded', function () {
            checkAuthentication();
            if (isAuthenticated) {
                initializeApp();
            }
        });

        // Adicionar estilos para os status de férias
        const style = document.createElement('style');
        style.textContent = `
    .vacation-status {
        font-size: 11px;
        color: #666;
        margin-top: 3px;
        font-style: italic;
    }
    
    .future-vacation {
        background-color: #e3f2fd !important;
        border-left: 4px solid #2196f3 !important;
    }
    
    .reset-vacation-btn:hover {
        background-color: #f57c00 !important;
    }
`;
        document.head.appendChild(style);
    </script>
</body>

</html>